# Инструкция по тестированию Meshtastic сообщений через MQTT Explorer

## Подключение к MQTT брокеру

1. Откройте MQTT Explorer
2. Подключитесь к брокеру:
   - **Host**: `192.168.1.172`
   - **Port**: `1883`
   - **Username**: `n1`
   - **Password**: `n1`

## Примеры сообщений для отправки

Все примеры находятся в файле `test_messages_mqtt.json`

### 1. Текстовое сообщение

**Топик**: `msh/2/json/!12345678/text`

**Payload (JSON)**:
```json
{
  "from": "!12345678",
  "payload": {
    "text": "Привет из MQTT Explorer! Тестовое сообщение."
  }
}
```

### 2. Позиционное сообщение

**Топик**: `msh/2/json/!12345678/position`

**Payload (JSON)**:
```json
{
  "from": "!12345678",
  "payload": {
    "latitude": 55.7558,
    "longitude": 37.6173,
    "altitude": 150
  }
}
```

### 3. Информация об узле (NodeInfo)

**Топик**: `msh/2/json/!12345678/nodeinfo`

**Payload (JSON)**:
```json
{
  "from": "!12345678",
  "payload": {
    "user": {
      "id": "!12345678",
      "longName": "Тестовый Узел",
      "shortName": "TEST",
      "hwModel": "TBEAM"
    }
  }
}
```

### 4. Телеметрия

**Топик**: `msh/2/json/!12345678/telemetry`

**Payload (JSON)**:
```json
{
  "from": "!12345678",
  "payload": {
    "batteryLevel": 75,
    "voltage": 4.2,
    "temperature": 22.5
  }
}
```

## Важные замечания

1. **Замените `!12345678`** на реальный ID узла в вашей сети Meshtastic
2. В топике используйте формат: `msh/2/json/{node_id}/{message_type}`
3. Убедитесь, что ваш бот запущен и подписан на соответствующие топики
4. Проверьте логи бота для подтверждения получения сообщений

## Порядок тестирования

1. Запустите бота (`python main.py`)
2. Откройте MQTT Explorer и подключитесь к брокеру
3. Отправьте сначала сообщение `nodeinfo` для регистрации узла
4. Отправьте текстовое сообщение
5. Проверьте Telegram - сообщение должно появиться в чате
6. Отправьте позиционное сообщение (должно прийти только администраторам)

## Формат топиков

- Текст: `msh/2/json/{node_id}/text`
- Позиция: `msh/2/json/{node_id}/position`
- Телеметрия: `msh/2/json/{node_id}/telemetry`
- Информация об узле: `msh/2/json/{node_id}/nodeinfo`

## Отладка

Если сообщения не обрабатываются:
1. Проверьте логи бота в `logs/bridge.log`
2. Убедитесь, что топик точно совпадает с подписками в `config.yaml`
3. Проверьте формат JSON - он должен быть валидным
4. Убедитесь, что поле `from` присутствует в payload

